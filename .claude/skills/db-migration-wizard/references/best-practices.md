# Alembic Resources

## Official Documentation
- [Alembic Documentation](https://alembic.sqlalchemy.org/)
- [SQLModel + Alembic Guide](https://sqlmodel.tiangolo.com/tutorial/alembic/)

## Best Practices

### 1. Always Review Autogenerated Migrations
Autogenerate is great but always review the generated code before applying.

### 2. Use Descriptive Migration Names
```bash
# Good
alembic revision -m "add_user_preferences_table"

# Bad
alembic revision -m "update"
```

### 3. Version Control Your Migrations
Never modify applied migrations. Create new ones instead.

### 4. Test Migrations on Staging First
Always run migrations on staging before production.

### 5. Have a Rollback Plan
Always implement `downgrade()` function.

## Common Patterns

### Adding a Column
```python
def upgrade():
    op.add_column('tasks', 'due_date', sa.DateTime(), nullable=True)

def downgrade():
    op.drop_column('tasks', 'due_date')
```

### Renaming a Column
```python
def upgrade():
    op.alter_column('tasks', 'title', new_column_name='name')

def downgrade():
    op.alter_column('tasks', 'name', new_column_name='title')
```

### Adding Index
```python
def upgrade():
    op.create_index('ix_tasks_user_id', 'tasks', ['user_id'])

def downgrade():
    op.drop_index('ix_tasks_user_id', table_name='tasks')
```

### Changing Column Type
```python
def upgrade():
    op.alter_column('tasks', 'description',
                     type_=sa.Text(),
                     existing_type=sa.String(length=500))

def downgrade():
    op.alter_column('tasks', 'description',
                     type_=sa.String(length=500),
                     existing_type=sa.Text())
```

## Production Checklist

- [ ] Migration tested on staging database
- [ ] Downgrade script tested
- [ ] Database backup created before migration
- [ ] Rollback plan documented
- [ ] Application code compatible with new schema
- [ ] Migration time estimated (during low traffic)
- [ ] Monitoring in place during migration
